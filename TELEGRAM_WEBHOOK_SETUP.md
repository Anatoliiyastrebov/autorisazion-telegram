# üîó –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Webhook –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ OTP

## –ó–∞—á–µ–º –Ω—É–∂–µ–Ω webhook?

Telegram Bot API –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ username –±–µ–∑ `chat_id`. Webhook –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å `chat_id` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ–≥–¥–∞ –æ–Ω –ø–∏—à–µ—Ç –±–æ—Ç—É.

## üìã –®–∞–≥–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí **SQL Editor**
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `supabase/migrations/002_add_telegram_chat_ids.sql`
3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä –∏ –Ω–∞–∂–º–∏—Ç–µ **Run**

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—É `telegram_chat_ids` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è chat_id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### 2. –î–µ–ø–ª–æ–π –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ Vercel

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ Vercel –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:
```
https://your-domain.vercel.app
```

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook –≤ Telegram

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –æ–¥–Ω–∏–º –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤:

**–°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ curl (–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)**
```bash
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://your-domain.vercel.app/api/telegram/webhook"}'
```

**–°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä**
–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–∑–∞–º–µ–Ω–∏—Ç–µ `<YOUR_BOT_TOKEN>` –∏ `your-domain`):
```
https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook?url=https://your-domain.vercel.app/api/telegram/webhook
```

**–°–ø–æ—Å–æ–± 3: –ß–µ—Ä–µ–∑ @BotFather**
1. –ù–∞–ø–∏—à–∏—Ç–µ `/setwebhook` –±–æ—Ç—É @BotFather
2. –£–∫–∞–∂–∏—Ç–µ URL: `https://your-domain.vercel.app/api/telegram/webhook`

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
```bash
curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getWebhookInfo"
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è JSON —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ webhook, –≤–∫–ª—é—á–∞—è –≤–∞—à URL.

### 5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

1. –ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ–º—É –±–æ—Ç—É –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/start`)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Supabase Dashboard ‚Üí Table Editor ‚Üí `telegram_chat_ids`
3. –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å—å —Å –≤–∞—à–∏–º username –∏ chat_id

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –±–æ—Ç—É:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/start`)
   - Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ –≤–∞—à webhook

2. **Webhook —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç chat_id:**
   - Webhook –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç `chat_id` –∏ `username` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É `telegram_chat_ids` –≤ Supabase

3. **–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ OTP:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç OTP –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ú–æ–∏ –∞–Ω–∫–µ—Ç—ã"
   - –°–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç `chat_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `telegram_chat_ids`
   - –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç OTP –∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   - –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫—É –Ω–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω **—Ö–æ—Ç—è –±—ã —Ä–∞–∑ –Ω–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/start`), —á—Ç–æ–±—ã –µ–≥–æ `chat_id` –±—ã–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω
- –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ OTP –∫–æ–¥—ã –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–∏—Å–∞–ª –±–æ—Ç—É, –æ–Ω —É–≤–∏–¥–∏—Ç –ø–æ–¥—Å–∫–∞–∑–∫—É –Ω–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º OTP

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Webhook –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω:
   ```bash
   curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getWebhookInfo"
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Vercel Dashboard ‚Üí Functions ‚Üí `api/telegram/webhook`

3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL webhook –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏ –¥–æ—Å—Ç—É–ø–µ–Ω

### Chat_id –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ SQL –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è `SUPABASE_URL` –∏ `SUPABASE_SERVICE_ROLE_KEY`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Vercel Dashboard

### OTP –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª –±–æ—Ç—É —Ö–æ—Ç—è –±—ã —Ä–∞–∑
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `chat_id` —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ —Ç–∞–±–ª–∏—Ü–µ `telegram_chat_ids`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Vercel Dashboard ‚Üí Functions ‚Üí `api/auth/send-otp`

## üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–î–æ–±–∞–≤—å—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É "–ú–æ–∏ –∞–Ω–∫–µ—Ç—ã" –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é:

> **–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞ –≤ Telegram:**
> 1. –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ [@your_bot_username] –≤ Telegram
> 2. –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É –∫–æ–º–∞–Ω–¥—É `/start` –∏–ª–∏ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
> 3. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –∑–∞–ø—Ä–æ—Å–∏—Ç–µ –∫–æ–¥ —Å–Ω–æ–≤–∞
